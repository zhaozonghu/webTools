!function(t){var i={AUXILIARY_LINE_COUMT:16,MAX_ROTATION_ANGLE:Math.PI/200,FIREWORK_INTERVAL:{min:30,max:100},init:function(){this.setParameters(),this.setupData(),this.reconstructMethod(),this.render()},setParameters:function(){this.$document=t(document),this.$window=t(window),this.$container=t("#jsi-sphere-container"),this.width=this.$container.width(),this.height=this.$container.height(),this.contextBackground=t("<canvas />").attr({width:this.width,height:this.height}).appendTo(this.$container).get(0).getContext("2d"),this.contextForeground=t("<canvas />").attr({width:this.width,height:this.height}).appendTo(this.$container).get(0).getContext("2d"),this.camera=h.init(this),this.angleX=this.MAX_ROTATION_ANGLE/2,this.angleY=this.MAX_ROTATION_ANGLE/2,this.points=[],this.fireworks=[],this.maxFireworkInterval=0|this.getRandomValue(this.FIREWORK_INTERVAL),this.fireworkInterval=this.maxFireworkInterval,this.base=Math.min(this.width,this.height),this.scatterRadius=3*this.base/2},reconstructMethod:function(){this.render=this.render.bind(this),this.changeDepth=this.changeDepth.bind(this),this.changeAngle=this.changeAngle.bind(this)},getRandomValue:function(t){return t.min+(t.max-t.min)*Math.random()},bindEvent:function(){this.$document.on("onwheel"in document?"wheel":"onmousewheel"in document?"mousewheel":"DOMMouseScroll",this.changeDepth),this.$container.on("mousemove",this.changeAngle)},setupData:function(){for(var t=1;t<this.AUXILIARY_LINE_COUMT;t++)for(var i=0,h=2*Math.PI/(2*this.AUXILIARY_LINE_COUMT-Math.abs(2*this.AUXILIARY_LINE_COUMT-4*t));i<2*Math.PI;i+=h)this.points.push(new e(this.camera,this.getAxis3D(Math.PI/this.AUXILIARY_LINE_COUMT*t,i)))},changeDepth:function(t){t.preventDefault(),this.camera.move(0,0,(t.originalEvent.deltaY||-t.originalEvent.wheelDelta||t.originalEvent.detail)>=0?3:-2)},changeAngle:function(t){var i=this.$container.offset(),h=t.clientX-i.left+this.$window.scrollLeft(),s=t.clientY-i.top+this.$window.scrollTop();this.angleY=(this.width/2-h)/this.width*2*this.MAX_ROTATION_ANGLE,this.angleX=(this.height/2-s)/this.height*2*this.MAX_ROTATION_ANGLE},getAxis3D:function(t,i){var h=Math.cos(t),s=Math.sin(t);return{x:this.scatterRadius*s*Math.cos(i),y:this.scatterRadius*h,z:this.scatterRadius*s*Math.sin(i)}},render:function(){requestAnimationFrame(this.render),this.contextForeground.clearRect(0,0,this.width,this.height),this.contextBackground.fillStyle="hsla(0, 0%, 0%, 0.2)",this.contextBackground.clearRect(0,0,this.width,this.height);for(var t=0,i=this.points.length;t<i;t++)this.points[t].rotateX(this.angleX),this.points[t].rotateY(this.angleY);for(t=0,i=this.fireworks.length;t<i;t++)this.fireworks[t].rotateX(this.angleX),this.fireworks[t].rotateY(this.angleY);this.points.sort(function(t,i){return i.getAxis3D().z-t.getAxis3D().z}),this.fireworks.sort(function(t,i){return i.getAxis3D().z-t.getAxis3D().z});for(t=this.points.length-1;t>=0;t--)this.points[t].render(this.contextForeground);for(t=this.fireworks.length-1;t>=0;t--)this.fireworks[t].render(this.contextBackground)||this.fireworks.splice(t,1);0==--this.fireworkInterval&&(this.fireworks.push(new n(this,this.camera)),this.maxFireworkInterval=0|this.getRandomValue(this.FIREWORK_INTERVAL),this.fireworkInterval=this.maxFireworkInterval)}},h={INIT_AXIS:{X:0,Y:0,Z:-2e3},MIN_Z:-3e3,FOCUS_DISTANCE:500,MAGNIFICATION:50,OFFSET:100,init:function(t){return this.renderer=t,this.x=this.INIT_AXIS.X,this.y=this.INIT_AXIS.Y,this.z=this.INIT_AXIS.Z,this},move:function(t,i,h){this.x+=t,this.y+=i,this.z-=h*this.MAGNIFICATION,this.z=Math.min(this.z,-this.renderer.scatterRadius),this.z=Math.max(this.z,this.MIN_Z)},rotate:function(t,i,h){this.angle.x+=t,this.angle.y+=i,this.angle.z+=h},getCompensatedParameters:function(t){var i=t.z-this.z;if(i<=this.OFFSET)return null;var h=this.FOCUS_DISTANCE/i,s=Math.min(80,250*h),e=this.renderer.width/2+(t.x+this.x)*h,n=this.renderer.height/2-(t.y+this.y)*h,a=t.RADIUS*h;return e+a<0||e-a>this.renderer.width||n+a<0||n-a>this.renderer.height?null:{x:e,y:n,radius:a,luminance:s,scale:h}}},s=function(i){this.parameters=null,t.extend(this,i)};s.prototype={COLOR:"hsl(%h, 80%, %l%)",rotateX:function(t){var i=Math.sin(t),h=Math.cos(t),s=this.y*h-this.z*i,e=this.z*h+this.y*i;this.y=s,this.z=e},rotateY:function(t){var i=Math.sin(t),h=Math.cos(t),s=this.x*h-this.z*i,e=this.z*h+this.x*i;this.x=s,this.z=e},rotateZ:function(t){var i=Math.sin(t),h=Math.cos(t),s=this.x*h-this.y*i,e=this.y*h+this.x*i;this.x=s,this.y=e},getAxis3D:function(){return{x:this.x,y:this.y,z:this.z}},getAxis2D:function(){return this.parameters=this.camera.getCompensatedParameters(this),this.parameters?(this.parameters.color=this.COLOR.replace("%h",this.hue).replace("%l",this.parameters.luminance),this.parameters):null}};var e=function(t,i){this.camera=t,this.x=i.x,this.y=i.y,this.z=i.z};e.prototype=new s({RADIUS:10,hue:240,render:function(t){var i=this.getAxis2D();i&&(t.save(),t.translate(i.x,i.y),t.beginPath(),t.fillStyle=i.color,t.arc(0,0,i.radius,0,2*Math.PI,!0),t.fill(),t.restore())}});var n=function(t,i){this.renderer=t,this.camera=i,this.init()};n.prototype=new s({PARTICLE_COUNT:0,DELTA_OPACITY:.01,RADIUS:12,THRESHOLD:30,DELTA_THETA:Math.PI/10,GRAVITY:-Math.PI/1e5,VELOCITY:Math.PI/160,init:function(){var t=this.renderer.getAxis3D(Math.PI*Math.random(),2*Math.PI*Math.random());this.hue=192,this.maxCount=this.renderer.getRandomValue({min:150,max:300}),this.count=0,this.x=t.x,this.y=t.y,this.z=t.z,this.status=0,this.theta=0,this.waitCount=this.renderer.getRandomValue({min:30,max:60}),this.opacity=1,this.particles=[];var i=this.renderer.getRandomValue({min:0,max:2*Math.PI});this.velocityX=this.VELOCITY*Math.cos(i),this.velocityY=this.VELOCITY*Math.sin(i)},render:function(t){switch(this.status){case 0:var i=this.getAxis2D();return i&&(t.save(),t.fillStyle=i.color,t.globalAlpha=this.maxCount-this.count<=this.THRESHOLD?Math.max(0,1-(this.THRESHOLD-this.maxCount+this.count)/this.THRESHOLD):1,t.translate(i.x+Math.sin(this.theta)/2,i.y),this.rotateX(this.velocityX),this.rotateY(this.velocityY),t.beginPath(),t.arc(0,0,i.radius,0,2*Math.PI,!1),t.fill(),t.restore()),this.count++>=this.maxCount&&(this.status=1),this.theta+=this.DELTA_THETA,this.theta%=2*Math.PI,this.velocity+=this.GRAVITY,!0;case 1:if(--this.waitCount<=0){this.status=2;for(var h=0,s=this.PARTICLE_COUNT;h<s;h++)this.particles.push(new a(this.camera,this.x,this.y,this.z,this.hue))}return!0;case 2:t.save(),t.globalCompositeOperation="lighter",t.globalAlpha=this.opacity;for(h=0,s=this.particles.length;h<s;h++)this.particles[h].render(t);return t.restore(),this.opacity-=this.DELTA_OPACITY,this.opacity>0}}});var a=function(t,i,h,s,e){this.camera=t,this.x=i,this.y=h,this.z=s,this.hue=e,this.init()};a.prototype=new s({RADIUS:10,GRAVITY:-.98,FRICTION:.98,init:function(){var t=2*Math.PI*Math.random(),i=this.getVelocity(),h=Math.random();this.vx=i*Math.cos(t)*h,this.vy=i*Math.sin(t)*h,this.vz=this.getVelocity()},getVelocity:function(){return 30*(1-Math.pow(Math.random(),6))},render:function(t){var i=this.getAxis2D();i&&(t.beginPath(),t.fillStyle=i.color,t.arc(i.x,i.y,i.radius,0,2*Math.PI,!1),t.fill(),this.x+=this.vx*i.scale,this.y+=this.vy*i.scale,this.z+=this.vz*i.scale,this.vy+=this.GRAVITY*i.scale,this.vx*=this.FRICTION,this.vy*=this.FRICTION,this.vz*=this.FRICTION)}}),i.init()}(jQuery);