var scroll=function(){var o;return{afterOpen:function(){o=document.scrollingElement.scrollTop||document.body.scrollTop,document.body.classList.add("noScroll"),document.body.style.top=-o+"px"},beforeClose:function(){document.body.classList.remove("noScroll"),document.body.style.top=0,document.scrollingElement.scrollTop=o,document.body.scrollTop=o}}}(),bookLand={iosSchema:"zhenyuexiaoshuo://",androidSchema:"qmzs://com.yr",params:"",iosParams:{},downUrl_AN:"",downUrl_IOS:"https://itunes.apple.com/cn/app/id1460644037?mt=8",iosOffLine:!0,qd:"",kfh:0,baseUrl:"http://bookapi.qmzhuishu.com:82/index.php?service=",pageNum:1,isEnd:!1,bookID:0,bookName:"",bookCover:"",chapterList:[],curIndex:0,topHeight:0,os:0,init:function(){var o=this;o.kfh=o.getURLParameter("kfh")||0,o.bookID=o.getURLParameter("id")||0,o.qd=o.getURLParameter("qd")||"fx_cpa_1_zonghe",o.downUrl_AN="https://apk.466fdgsf.xyz:10442/direct/"+o.qd,"android"==o.sysTemInfo()?o.os=1:"ios"==o.sysTemInfo()&&(o.os=2),o.showSubTit(),o.getNovelDetail(),o.bindEvent()},getNovelDetail:function(){var o=this;$.ajax({url:o.baseUrl+"ShareV204.Novel.NovelInfo",data:{id:o.bookID},success:function(e){e.data.info.novel_name&&(o.bookName=e.data.info.novel_name,o.bookCover=e.data.info.novel_cover,$("#jsNovelInfo").html("<h1>"+e.data.info.novel_name+"</h1><span>"+e.data.info.novel_author+"</span>"),o.topHeight=$("#jsNovelInfo").height()+20,o.getNovelChapterList())}})},getNovelChapterList:function(){var o=this,e="novel_id="+o.bookID+"&8Xe!YGE*%6q@hC1f",t=$.md5(e).toUpperCase();$.ajax({url:o.baseUrl+"ShareV204.Chapter.ChapterList",data:{novel_id:o.bookID,sign:t},success:function(e){if(e.data.length){o.chapterList=e.data,$("#jsChapterNums").html("共"+o.chapterList.length+"章");var t="";$.each(e.data,function(o,e){o<60&&(t+='<dd><a href="javascript:;" data-id="'+e.chapter_id+'" data-index="'+o+'" id="chapterItem_'+o+'" class="item">'+e.chapter_name+"</a></dd>")}),t+='<dd><a href="javascript:;" class="jsShowPop">更多章节...</a></dd>',$("#jsChapterList").html(t),o.getNovelChapterInfo(o.chapterList[0].chapter_id,0)}}})},getNovelChapterInfo:function(o,e){var t=this,n="id="+o+"&8Xe!YGE*%6q@hC1f",a=$.md5(n).toUpperCase();$.ajax({url:t.baseUrl+"ShareV204.Chapter.WapChapterInfo",data:{id:o,sign:a},success:function(n){n.data?($("#js_loadBox").hide(),$("#jsChapterTit,#jsFly").html(n.data.chapter_name),$("#jsChapterCon").html(n.data.content.replace(/\n|\r\n/g,"<br/>")),t.curIndex=parseInt(e),t.chapterID=o,t.changeState()):$("#jsPop").fadeIn()}})},changeState:function(){var o=this;$("#jsChapterList dd a").removeClass("active"),$("#chapterItem_"+o.curIndex).addClass("active"),0==o.curIndex&&$("#btnPrev").addClass("off"),o.curIndex>0&&$("#btnPrev").removeClass("off"),$("html,body").animate({scrollTop:o.topHeight},200),o.pushMsg()},pushMsg:function(){var o=this,e=new MobileDetect(window.navigator.userAgent),t="",n="",a="",i=Date.parse(new Date);a=1==o.os?e.version("Android")||0:e.version("iOS")||0,t="chapter_index="+(parseInt(o.curIndex)+1)+"&novel_id="+o.bookID+"&os="+o.os+"&timestamp="+i+"&version="+encodeURIComponent(a.toFixed(1))+"&SAxGMYdGcyzz04kJPyfYR4b3I6TaLFH1",n=$.md5(t).toUpperCase(),$.ajax({url:"http://wup.qmzhuishu.com:82/v1/wap-share/commit-novel-history",type:"post",data:{chapter_index:parseInt(o.curIndex)+1,novel_id:o.bookID,os:o.os,timestamp:i,version:a.toFixed(1),sign:n},success:function(o){}})},showSubTit:function(){var o=$("#jsFly");$(window).scroll(function(){$(this).scrollTop()>100?o.addClass("show"):o.removeClass("show")})},stopBack:function(){var o=this,e=0;window.history&&window.history.pushState&&($(window).on("popstate",function(){e++,Number(e)<=o.kfh||0==o.kfh?(window.history.pushState("forward",null,document.URL),window.history.forward(1)):window.history.go(-1)}),window.history.pushState("forward",null,document.URL),window.history.forward(1))},setWindow:function(){var o=$(window).height(),e=$(window).width();$("body").height(o).width(e)},resize:function(){var o=this;$(window).on("resize",function(){o.setWindow()})},sysTemInfo:function(){var o=navigator.userAgent.toLowerCase();return o.indexOf("android")>-1||o.indexOf("linux")>-1||-1!=navigator.platform.toLowerCase().indexOf("linux")?"android":o.indexOf("iphone")>-1||o.indexOf("ipad")>-1?"ios":void 0},isWeChat:function(){var o=navigator.userAgent.toLowerCase();return"micromessenger"==o.match(/MicroMessenger/i)},weChatRes:function(o){var e='<div class="wechat"><img src="'+o+'" alt="点击右上角，然后选择浏览器打开！"/></div>';$("body").append(e),$(document).on("click",".js_btn_down",function(){$(this).attr("href","javascript:;"),$(".wechat").css("height",$(window).height()).show()})},down:function(){var o=this;o.params="?d="+o.bookID+"&i="+(parseInt(o.curIndex)+1),o.iosParams="?d="+o.bookID+"&i="+(parseInt(o.curIndex)+1)+"&n="+o.bookName+"&c="+o.bookCover,"android"==o.sysTemInfo()?(window.location.href=o.androidSchema+o.params,window.setTimeout(function(){window.location.href=o.downUrl_AN},500)):"ios"==o.sysTemInfo()&&(window.location.href=o.iosSchema+encodeURI(o.iosParams),window.setTimeout(function(){window.location.href=o.downUrl_IOS},500))},getURLParameter:function(o){return decodeURIComponent((new RegExp("[?|&]"+o+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null},getLocalStorge:function(o){if(window.localStorage)return localStorage[o]||null;var e,t=new RegExp("(^| )"+o+"=([^;]*)(;|$)");return e=document.cookie.match(t),e?window.unescape?window.unescape(e[2]):e[2]:null},setLocalStorge:function(o,e){if(window.localStorage)localStorage[o]=e;else{var t=new Date;t.setTime(t.getTime()+2592e6),e=window.escape?window.escape(e):e,document.cookie=o+"="+e+";expires="+t.toGMTString()}},delLocalStorge:function(o){var e=t.getLocalStorge(o);void 0!==e&&(window.localStorage?delete localStorage[o]:document.cookie=o+"="+e+";expires="+new Date(0).toGMTString())},bindEvent:function(){var o=this;$(document).on("click",".jsDownApp",function(){o.down()}),$(".toolBar .btn").click(function(){var e=$(this).attr("data-type");if("prev"==e?o.curIndex-=1:o.curIndex+=1,o.curIndex<0)return o.curIndex=0,!1;o.getNovelChapterInfo(o.chapterList[o.curIndex].chapter_id,o.curIndex)}),$(document).on("click","#jsChapterList dd .item",function(){var e=$(this).attr("data-id"),t=$(this).attr("data-index");o.getNovelChapterInfo(e,t)}),$(document).on("click",".jsClosePop",function(){$("#jsPop").fadeOut()}),$(document).on("click",".jsShowPop",function(){$("#jsPop").fadeIn()}),$(".jsShowChapter").click(function(){$("#jsChapterBox").addClass("open"),scroll.afterOpen(),$("#jsMask").stop().delay(200).fadeIn()}),$("#jsChapterBox").click(function(){$(this).removeClass("open"),scroll.beforeClose(),$("#jsMask").stop().delay(200).fadeOut()})}};$(function(){bookLand.init()});